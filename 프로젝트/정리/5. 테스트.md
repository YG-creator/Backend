# Junit

# 설정

build.gradle에 dependency에 추가

* testImplementation('org.springframework.boot:spring-boot-starter-test')



# 통합

@SpringBootTest



# Service 

1. @ExtendWith(Service이름.class) : 사용할 Service scan

2. @Mock : service 이외의 것들 가짜 객체 생성(cost, 의존성 최소화)

3. @InjectMocks : 사용하는 Service에 생성한 가짜 객체들 주입

4. @Test : 테스트 함수 지정

   1. 테스트 함수 작성

      1. given : 입력, 결과

         ```java
         given(productRepo.findById(any())).willReturn(Optional.of(new Product("product-test")));
         ```

      2. when : 함수 실행

         ```java
         Product product = testService.findTest(productId);
         ```

      3. then : 결과 확인

         ```java
         assertNotNull(product);
         ```



# Repository

1. H2 vs JDBC

   1. H2인 경우 추가

      1. @AutoConfigureTestDatabase(replace = Replace.NONE) 

         자동을 설정되는 DB 정보를 사용하지 않고

      2. @Import(H2ServerConfiguration.class)

         H2ServerConfiuration을 씀

2. @DataJpaTest : 사용할 Repository scan

3. @Autowired : 테스트 : respository에 필요한 의존 객체 주입

4. @Test : 테스트 함수 지정 

   ```java
   @Test
   void testSave() {
       // given
       Product product = new Product();
       product.setProductName("tset-prd");
   
       List<Item> items = new ArrayList<Item>();
       for(int i = 0 ; i < 4 ; i++) {
           Item item = new Item();
           item.setItemId("test-item-"+i);
           item.setItemName("test-item-"+i);
           item.setItemNumber("test-item-"+i);
           item.setProduct(product);
       }
       product.setItems(items);
       productRepo.save(product);
   	
       // when
       String productId = product.getProductId();
       Product findProduct = productRepo.findById(productId).orElse(null);
   	
       // then
       Assertions.assertNotNull(findProduct);
       Assertions.assertEquals(findProduct.getProductId(), productId);
   }
   ```

   

# Controller

1. @WebMvcTest(Controller이름.class) : 사용할 Controller scan

2. @MockBean : 사용할 Service 가짜객체 사용

3. @Autowired : mvc에 가짜객체 주입

4. @Test : 테스트 함수 지정 

   1. given : 입력, 결과

      ```java
      Product productStub = new Product("product-test");
      productStub.setProductId("fc00ddb5-9f05-40a0-beb9-4ea5431379c0");
      
      given(sampleService.getProduct(any()))
          .willReturn(productStub);
      ```

   2. when : 실행

      ```java
      final ResultActions actions = mockMvc.perform(MockMvcRequestBuilders.get("/user/getProduct").param("productId", productId));
      ```

   3. then : 확인

      ```java
      actions
          .andDo(print())
          .andExpect(status().isOk())
          .andExpect(jsonPath("$.productId").value(productId));
      ```

      

# Spock

* 함수이름 한글로도 가능

* 코드블록으로 구분되어있음(given,when,then)

* Junit 요소들 모두 제공

* 중복코드 제거 가능(where)

