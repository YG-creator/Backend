# Release

1. README.md 수정

   GitHub에서 README 파일 편집 -> pull request -> reabse and merge -> confirm

2. tag 생성

   [소프트웨어 버전 작성](https://ko.wikipedia.org/wiki/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4_%EB%B2%84%EC%A0%84_%EC%9E%91%EC%84%B1) 참고

   GitKraken main에서 create tag(버전이름) -> push

3. release 생성

   GitHub에서 tag -> Releases -> create a new release -> tag 선택 -> 생성



# Cloud 배포

Heroku로 함

1. create a new Pipeline
   1. 이름
   2. 연동

2. create new app

   1. 이름

3. DB 추가

   Heroku -> Resources -> Add-ons -> ClearDB MySQL(무료ver) 추가 

4. DB 경로 추가

   1. 경로 확인

      Heroku -> Settings -> Config Vars -> Reveal Config Vars -> mysql~ 복사

   2. application.yaml 에 추가

      ```yaml
      ---
      spring:
        config.activate.on-profile: heroku
        datasource:
          url: ${CLEARDB_DATABASE_URL}	# 추가한 부분
        jpa.hibernate.ddl-auto: create
        sql.init.mode: always
      ```

5. Heroku 경로 README.md에 적어주기

   Heroku -> settings -> domains에 있음

6. 설정

   1. Set up

      1. Documentation -> Get Started -> Java -> Set up -> OS에 맞게 설치 

      2. cmd -> heroku login 치기 -> 아무키 누르기

   2. Prepare the App

      1. build.gradle에서 version 수정(version = 'v1.0') -> 오른쪽 gradle -> clean -> build

      2. Profile에 jar파일 설정

         1. build -> libs에서 확인

            안보이면 : 설정 -> Tree Appearance -> Show Excluded File

         2. 가장 바깥쪽에 Profile 파일 생성 후 위치 적기

            ```java
            web: java $JAVA_OPTS -Dserver.port=$PORT -Dspring.profiles.active=heroku -jar build/libs/demo-v1.1.jar
            ```

      3. system.properties에서 java version 설정

         1. 가장 바깥쪽에 system.properties 파일 생성 후 java version 설정

            ```java
            java.runtime.version=17
            ```

   3. Deploy the App

      1. build.gradle에 main class 설정(package 확인)

         ```yaml
         jar {
         	manifest {
         		attributes('Main-Class': 'package com.example.projectboard.DemoApplication')
         	}
         }
         ```

      2. merge

         commit -> pull request -> merge

      3. cmd
         1. 프로젝트 파일 있는 경로로 이동
         2. heroku create
         3. heroku git:remote --app 앱이름
         4. git push heroku main
         4. heroku logs --tail
      
      

## 주의점

cloud 배포하면 self-hosted-runner가 되서 GitKraken 못씀
