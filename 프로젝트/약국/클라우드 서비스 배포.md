# Profile 작성

1. docker-compose.yml 작성

   1. 기존 docker-compose-local.yml 복사

   2. pharmacy-recommendation-app 추가

      1. container 이름

      2. build 장소

      3. 실행 순서(database, redis 실행 후)

      4. 환경변수 추가

         1. .env값 확인

            `vi .env`

         2. 값 주입

            `환경변수=값`

         3. 저장

            `wq`

      5. port 설정

      6. 재시작(database,redis 실행 실패시 재실행)

2. application.yml에서 profile 작성

   1. profile 이름 설정
   2. 기존 local profile properties 복붙
   3. url host 부분을 서비스명을 수정
   4. pharmacy url를 EC2 사용후 수정 예정

3. 재 build

   `gradlew clean build -PKAKAO_REST_API_KEY={key 값}`

4. docker 실행

   1. docker Image 재 build

      docker-compose가 default로 설정 되어있으므로 -> 바로 빌드

      `docker-compose up --build`

5. cmd로 container 정상적으로 작동하는지 확인

   1. docker ps

      container 3개 확인(database,redis,app)

6. 웹브라우저로 확인

   1. localhost만 url에 입력

      port 설정으로 자동 매핑해줘서 그럼

      

# AWS EC2

## 사전 준비

1. [회원가입](https://aws.amazon.com/ko/)

2. [어떤거 무료?](https://aws.amazon.com/ko/free/?all-free-tier.sort-by=item.additionalFields.SortRank&all-free-tier.sort-order=asc&awsf.Free%20Tier%20Types=*all&awsf.Free%20Tier%20Categories=*all)

   Amazon EC2 월별 50시간 1년 무료

3. [Elastic IP](https://aws.amazon.com/ko/premiumsupport/knowledge-center/elastic-ip-charges/)

   * 고정 IP 할당
   * 무료 조건
     * 1개
     * 사용중인 EC2 서버에 연동 상태

4. EC2(Elastic Compute Cloud)  개념

   클라우드에서 제공되는 컴퓨터



## AWS EC2 생성

[EC2 생성 가이드](https://wonyong-jang.github.io/aws/2022/06/05/AWS-EC2-Elastic-IP.html) 참고

1. AWS EC2 생성

   1. 리전 확인

      우측 상단 서비스가 구동될 지역 확인(Seoul)

   2. 인스턴스 시작 클릭

   3. 이름 및 태그 입력

      EC2 인스턴스 이름

   4. AMI 선택

      frre tier인 `Amazon Linux 2 AMI (HVM)` 선택

   5. 인스턴스 유형 선택

      free tier인 `t2.micro` 선택

   6. 키 페어 생성

      EC2 서버에 SSH 접속(terminal로 접속)을 하기 위해서 필수, 노출되면 안됨

      * 이름
      * 키페어 유형(RSA)
      * 파일 형식(.pem)

   7. 네트워크 및 스토리지 선택

      1. 방화벽 설정

         1. 보안 그룹 생성 체크

         2. SSH 트래픽 허용 체크 + 내 IP 선택

      2. 스토리지 구성

         30G까지 무료이므로 `30` 입력

   8. 우측하단 인스턴스 시작 버튼 클릭

2. Elastic IP(고정 IP) 설정

   1. Elastic IP 메뉴 접근
      1. 왼쪽 메뉴에서 Elastic IP 클릭
      2. 할당 버튼 클릭
   2. Elastic IP 주소 선택
      1. 방금 생성한 Elastic IP 선택
      2. 우측상단 작업 - Elastic IP 주소 연결 선택
   3. 인스턴스 선택 및 연결
      1. 연결할 인스턴스 선택
      2. 프라이빗 IP 선택
      3. 연결 버튼 클릭
   4. 인스턴스 정보 확인
      1. 왼쪽 EC2 대시보드 클릭
      2. 인스턴스(실행 중) 클릭
      3. Elastic IP가 연결되어 있음
   5. 무료조건
      1. 1개만
      2. 실행중인 EC2에 연결 상태

3. 삭제 방법(필요시)

   1. Elastic IP 삭제
      1. 우측상단 작업 - Elastic IP 주소 연결 해제
      2. 우측상단 작업 - Elastic IP release
      3. 릴리즈 버튼 클릭
   2. EC2 삭제
      1. 우측상단 인스턴스 상태 - 인스턴스 종료
      2. 상태가 terminated로 변경되면 삭제 성공 

4. SSH 클라로 서버 접속(필요시)

   AWS에서 정보 접속 서벗 방법 제공

   * 인스턴스 정보 - 연결버튼 클릭 - SSH 클라이언트 확인

5. 보안그룹 설정

   1. 왼쪽 메뉴 - 보안그룹 클릭
   2. 보안 그룹 클릭
   3. 아웃바운드 규칙 - 모두허용 되어있음
   4. 인바운드 규칙
      1. 자신의 IP에서만 SSH 허용 되어있음
      2. 규칙 추가 클릭
         1. 모든 사용자 HTTP 허용 추가
      3. 저장 버튼 클릭







# 최종 배포

1. application.yml

   1. pharmacy url에 Elastic IP 넣기

2. 서버 접속

   window는 https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/putty.html 참고

   * OpenSSH 방법
   * PuTTY 방법

3. Git 설치

   

4. docker
   1. 설치
      1. docker
      2. docker-compose
   2. docker 시작
   3. 실행권한 적용

5. git clone으로 소스 다운받기

6. docker 환경변수 입력

   1. .env 파일 생성

      `vi .env`

   2. 환경변수 입력

   3. 저장

      `wq`

   4. 환경변수 주입 확인

      `docker-compose config`

7. JDK 설치 및 jar 파일 생성
8. docker-compose로 build
9. 웹브라우저에서 확인
   1. Elastic IP url에 입력
