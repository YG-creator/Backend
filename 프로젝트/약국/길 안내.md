# kakao 지도 URL 사용

1. URL 확인

   https://apis.map.kakao.com/web/guide/#routeurl 참고

   1. 지도 url

      `https://map.kakao.com/link/map/`

   2. 로드뷰 url

      `https://map.kakao.com/link/roadview/`

2. output entity -> output dto로 바꾸는 함수값 수정

   1. directionUrl(지도 url + 결과entity.약국명 + "," + 결과entity.위도 + "," + 결과entity.경도)
      * 약국명이 한글이므로 uriComponentsBuilder 사용
      * encoding은 안함 -> controller가 restTemplate으로 encoding해서 중복문제 발생

   2. roadViewUrl(로드뷰 url + 결과entity.위도 + "," + 결과entity.경도)

3. docker 실행

   `docker-compose -f docker-compose-local.yml up`

4. application 실행

5. 웹 브라우저로 확인

   

# shorten url 개발

* 상황

  일반 encoding을 하면 URL이 너무 길어짐

* 해결책

  10진수 보다 큰 진수로 encoding하자

  1. base64 -> 사용불가

     `=` 과 같은 특수문자가 URL 예약어라서 불가능 

  2. base62 -> 사용가능

* shorten url로 길안내 링크

  http://{ip}/dir/{encodedId} -> 카카오 길찾기 API

  1. shorten url 만들기
     1. output entity -> output dto 함수 수정
        1. 길안내 URL을 수정
           1. base62로 directiontionId encoding

  2. shorten url 링크 만들기

     1. Controller
        1. GetMapping
           1. PathVariable로 encodedId 가져오기
        2. encodedId로 direction 찾기
        3. URI(String) 만들기
        4. return "redirect: " + result
     2. Service
        1. encodedId decoding 하기

  3. docker-compose 실행

     `docker-compose -f docker-compose-local`

  4. 웹브라우저로 확인

     1. 길안내 링크 짧아짐
     2. 링크 누르면 kakao 길안내 나옴



# 테스트 케이스 작성

shorten url에서 entity -> dto 작업 필요

1. Service
   1. Service DI
   2. encoding, decoding 확인

2. Controller

   1. mock 객체 생성

      1. Service에 DI 되어있는 거

   2. DI

      1. Controller에서 사용하는 Serivce 생성자에 mock 객체들 넣기

   3. def set up

      1. mockMvc build

   4. def 테스트코드

      1. given : 

         1. encodedId 값 정하기
         2. redirectURL 값 정하기

      2. when : 

         1. service mock 값을  redirectURL 로 지정
         2. mockMvc 실행

      3. then

         1. redirect 발생 확인
         2. redirect 경로 확인

         

# jar 파일 만들기

application.yml에 KAKAO_REST_API_KEY를 줘야됨

1. build.gradle에서 설정 추가

   ```
   processTestResources {
       boolean hasProperty = project.hasProperty("KAKAO_REST_API_KEY")	// 값 받았는지 확인
       System.out.println("Set kakao rest api key: $hasProperty")
       filesMatching('**/application.yml') {	// application.yml에 값 전달
           expand(project.properties)
       }
   }
   ```

2. key값 설정

   `gradlew clean build -PKAKAO_REST_API_KEY={키값}`
