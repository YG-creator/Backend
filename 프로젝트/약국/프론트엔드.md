* by Handlebars



# View 만들기

Handlebars 템플릿 엔진을 사용

1. 주소 입력 화면
2. 결과 화면



• https://wonyong-jang.github.io/web/2022/04/23/Web-Template-EngineHandlebars.html 참고

1. Handlebars 연동

   1. dependency 추가

      ```
      implementation 'pl.allegro.tech.boot:handlebars-spring-boot-starter:0.3.4'
      ```

   2. Handlebars  파일 생성

      src/main/resources/templates에 main.hbs 파일을 생성

      1. 입력란 
      2. 검색버튼

   3. Controller 생성

      handlebars-spring-boot-starter 덕분에 컨트롤러에서 문자열을 반환할 때 앞의 path와 뒤의 파일 확장자는 자동으로 지정된다.

2. bootsrap과 jQuery 연동

   1. download

      CDN은 외부 서버에 문제 발생시 사용 못하므로 download 선택 

      1. bootstrap

         [부트스트랩](https://getbootstrap.com/) 에서 우측 상단의 Download를 클릭

      2. jQuery

          [jQuery](https://jquery.com/download/) 에서 Download the compressed, production jQuery 3.6.0을 파일로 저장

         jquery-3.6.0.min.js를 jquery.min.js로 이름을 변경

   2. 복사

      1. bootstrap 

         1. bootstrap.min.css

            src/main/resources/static/css/lib로 복사

         2. bootstrap.min.js

            src/main/resources/static/js/lib로 복사

      2. jQuery

         1.  jquery.min.js

            src/main/resources/static/js/lib로 복사

         

   3. 라이브러리를 추가

      * css는 최상단, js는 최하단 -> 페이지 로딩 속도를 높이기 위해서

      ```html
      <html>
      <head>
      
          <!--부트스트랩 css 추가-->
          <link rel="stylesheet" href="/css/lib/bootstrap.min.css">
      </head>
      <body>
          ...
      
          <!--부트스트랩 js, jquery 추가-->
          <script src="/js/lib/jquery.min.js"></script>
          <script src="/js/lib/bootstrap.min.js"></script>
      </body>
      </html>
      ```

3. 실행

   1. docker-compose 실행

      `docker-compose-lovcal.yml up`

   2. application 실행

   3. 웹브라우저로 접속해보기

      

# 우편번호 서비스 적용

* https://postcode.map.daum.net/guide

1. src 복붙

   ```
   <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
   ```

2. 기능 추가

   1. 입력란 누르면 우편번호 서비스 팝업이 뜸
   2. 선택한 주소값이 기입됨



# 메인, 결과 화면 구현

1. dto 구현
   1. 입력
   2. 출력
2. Controller
   1. 추천 결과를 출력 view에 전달 by modelAndView
      1. 뷰이름
      2. 객체이름, dto

3. service
   1. 추천 결과 entity list -> dto list





# MockMvc를 이용한 테스트 코드 작성

* https://wonyong-jang.github.io/spring/2022/07/08/Spring-MockMvc.html 참고

* 사용처

  Controller Layer 테스트

* Controller test

  서블릿 컨테이너가 구동되고 DispatcherServlet 객체가 메모리에 올라가야 웹환경에서 테스트 가능

* MockMvc

  MockMvc = 서블릿 컨테이너 Mocking = 실제 서블릿 컨테이너가 아닌 테스트 모형 컨테이너 사용하는 것

* MockMvc 설정
  * MockMvcBuilders
    * standaloneSetup() 메서드 : 통합 테스트
    * webAppContextSetup() 메서드 : 유닛 테스트

* Controller test 사항

  * mapping
  * 입력 파라미터
  * model에 설정한 값
  * 요청 결과 페이지

* MockMvc 메서드

  * perform() : 요청 전송

  * HTTP method

  * params() : 파라미터 전달

  * andExpect() : 검증

    * status()
      * isOk() : 200
      * isNotFound() : 404
      * isMethodNotAllowed() : 405
      * isInternalServiceError() : 500
      * is(상태코드) : 상태코드
    * view()
      * name("뷰 이름") : 뷰 이름
    * handler() : 요청에 매핑된 컨트롤러 검증
    * redirect() 
    * attribute() 
      * atributeExists(이름) : 이름에 해당하는 데이터가 model에 있는지 검증
      * attribute(이름, 값) : 이름에 해당하는 값 검증

  * content() : 응답 정보 검증

  * ContentType() : 헤더 확인 

    

    

1. 테스트 코드 작성

   1. 메인페이지 확인

      expect:

      1. mockMvc perform
      2. handler 확인
         1. handlerType(controller 이름)
         2. 메소드 이름
      3. 상태 확인
      4. 뷰 이름 확인
      5. 로그 확인

   2. 결과페이지 확인

      1. given:

         입력 주소값 설정

      2. when

         mockMvc.perfomr().param()

      4. then
         1. 함수 호출 횟수 확인
         2. 입력값이 잘 전달 되었는지 확인
         3. 결과값 mocking
         4. 상태 확인
         5. 뷰 확인
            1. 이름
         6. model 확인
            1. attribute 존재여부
            2. 값 확인
         7. 로그 확인



2. docker 실행

   `docker-compose - f docker-compose-local.yml`

3. application 실행

4. 웹 브라우저로 확인

